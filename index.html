<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Ph√¢n lo·∫°i qu·∫£ b·∫±ng AI</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: sans-serif; text-align: center; padding: 20px; }
    video, canvas, img { max-width: 100%; height: auto; border: 1px solid #ccc; margin-top: 10px; }
    #result { margin-top: 15px; font-size: 18px; font-weight: bold; }
    button, input[type=file] { margin: 10px; padding: 10px; font-size: 16px; }
  </style>
</head>
<body>

<h2>Ch·ª•p ·∫£nh ho·∫∑c ch·ªçn ·∫£nh ƒë·ªÉ ph√¢n lo·∫°i qu·∫£</h2>

<video id="video" width="300" height="225" autoplay muted playsinline></video><br>
<button onclick="capture()">üì∏ Ch·ª•p ·∫£nh</button>
<br>Ho·∫∑c<br>
<input type="file" accept="image/*" onchange="handleFileUpload(this)" />

<canvas id="canvas" width="300" height="225" style="display:none;"></canvas>
<img id="preview" src="#" style="display:none;" />

<div id="result">K·∫øt qu·∫£ </div>

<script>
  const video = document.getElementById('video');
  const canvas = document.getElementById('canvas');
  const preview = document.getElementById('preview');
  const result = document.getElementById('result');

  // Ngrok backend URL ‚Äî nh·ªõ s·ª≠a th√†nh ƒë√∫ng ƒë·ªãa ch·ªâ
  const API_URL = "https://47b4-34-168-113-15.ngrok-free.app/predict";

  // Kh·ªüi ƒë·ªông webcam (n·∫øu c√≥)
  navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } })
    .then(stream => video.srcObject = stream)
    .catch(err => console.log("Kh√¥ng m·ªü ƒë∆∞·ª£c camera:", err));

  function capture() {
    const ctx = canvas.getContext('2d');
    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

    canvas.toBlob(blob => {
      sendImage(blob);
    }, 'image/jpeg');
  }

  function handleFileUpload(input) {
    const file = input.files[0];
    if (!file) return;

    preview.src = URL.createObjectURL(file);
    preview.style.display = "block";
    sendImage(file);
  }

  function sendImage(file) {
    result.textContent = "ƒêang g·ª≠i ·∫£nh...";
    const formData = new FormData();
    formData.append('image', file);

    fetch(API_URL, {
      method: 'POST',
      body: formData
    })
    .then(res => res.json())
    .then(data => {
      if (data.label) {
        result.textContent = `K·∫øt qu·∫£: ${data.label} (${data.confidence}%)`;
        result.style.color = data.label === "Qu·∫£ t∆∞∆°i" ? 'green' : 'red';
      } else {
        result.textContent = "Kh√¥ng nh·∫≠n ƒë∆∞·ª£c k·∫øt qu·∫£.";
        result.style.color = 'black';
      }
    })
    .catch(err => {
      console.error(err);
      result.textContent = "L·ªói khi g·ª≠i ·∫£nh ƒë·∫øn server.";
    });
  }
</script>

</body>
</html>
